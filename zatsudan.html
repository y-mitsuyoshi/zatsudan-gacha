<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>雑談テーマガチャ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
        }
        .btn-active-effect {
            transition: transform 0.1s ease, box-shadow 0.2s ease;
        }
        .btn-active-effect:active {
            transform: scale(0.96);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.15);
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 1rem center;
            background-size: 1.2em;
            padding-right: 2.5rem;
        }
        /* ローディングスピナー */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-6 md:p-8 rounded-2xl shadow-xl text-center w-full max-w-lg mx-auto">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">雑談テーマガチャ</h1>
        <p class="text-gray-500 mb-6">リモートでも、雑談でつながろう。</p>

        <div class="mb-6">
            <label for="category-select" class="block text-left text-sm font-medium text-gray-700 mb-2">カテゴリを選ぶ:</label>
            <select id="category-select" class="w-full p-3 border border-gray-300 rounded-lg bg-white shadow-sm focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                <!-- カテゴリはJSで動的に追加 -->
            </select>
        </div>

        <div id="theme-display" class="bg-gray-50 rounded-lg p-6 min-h-[150px] flex items-center justify-center mb-6 border border-gray-200 transition-all duration-300">
            <p class="text-lg text-gray-600">カテゴリを選んでボタンを押してね！</p>
        </div>

        <!-- Gemini API 機能エリア -->
        <div id="gemini-feature-area" class="hidden mb-6">
             <button id="dig-deeper-button" class="w-full bg-white border border-indigo-600 text-indigo-600 hover:bg-indigo-50 font-bold py-3 px-6 rounded-lg text-lg transition-all duration-200 shadow-sm hover:shadow-md btn-active-effect flex items-center justify-center">
                <span class="mr-2">✨</span> AIに深掘り質問を考えてもらう
            </button>
            <div id="dig-deeper-results" class="hidden mt-4 text-left bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                <!-- AIからの回答がここに表示されます -->
            </div>
        </div>

        <button id="gacha-button" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 px-6 rounded-lg text-xl transition-all duration-200 shadow-md hover:shadow-lg btn-active-effect">
            ガチャを回す
        </button>
    </div>

    <script>
        // カテゴリとテーマのデータ
        const themeData = {
            "趣味": ["一番お金をかけている趣味は？", "最近始めた新しい趣味は？", "インドア派？アウトドア派？", "子供の頃にハマっていたことは？", "これから挑戦してみたい趣味は？", "休日の過ごし方の定番は？", "あなたのコレクションを教えて！", "趣味で得した経験は？", "人にオススメしたい趣味は？", "今までで一番熱中したことは？", "スポーツ観戦は好き？どのチームのファン？", "音楽鑑賞、どんなジャンルを聴く？", "ゲームはする？好きなタイトルは？", "DIYや手芸はする？", "写真撮るの好き？何を撮る？", "ガーデニングや家庭菜園の経験は？", "釣りはしますか？", "キャンプの魅力って何？", "楽器、何か演奏できる？", "ボードゲームやカードゲームのおすすめは？", "ダンスやヨガは習ったことある？", "美術館や博物館によく行く？", "サウナ好き？こだわりは？", "コーヒーや紅茶、こだわりある？", "御朱印集めしてる？", "謎解きや脱出ゲーム好き？", "プラモデル作ったことある？", "詩や小説を書いたりする？", "自分の趣味をプレゼンしてください！", "eスポーツに興味ある？"],
            "旅行": ["今までで一番良かった旅行先は？", "忘れられない旅の思い出は？", "次に行きたい国や場所は？", "国内旅行と海外旅行、どっちが好き？", "旅行の計画はしっかり立てる派？ノープラン派？", "旅先での一番の失敗談は？", "おすすめの旅行グッズを教えて！", "一人旅の経験は？", "必ず買うお土産は？", "印象に残っている景色は？", "旅先で食べた絶品グルメは？", "豪華なホテルと格安宿、どっちを選ぶ？", "世界遺産、どこに行ったことがある？", "まだ行ったことのない都道府県は？", "旅行に必ず持っていくものは？", "飛行機、電車、車、どの移動手段が好き？", "旅先での出会いで印象的だったことは？", "パワースポット巡りしたことある？", "秘境や絶景、どこか知ってる？", "温泉旅行の思い出は？", "島旅の魅力って？", "バックパッカー経験ある？", "クルーズ旅行ってどう思う？", "旅行中の写真、何枚くらい撮る？", "現地の言葉、少しは覚える？", "マイルやポイント貯めてる？", "旅行先で体験したアクティビティは？", "お城巡り好き？", "空港で好きな過ごし方は？", "理想の旅行プランを語って！"],
            "ニュース": ["最近気になったニュースは？", "ちょっと嬉しくなった良いニュースは？", "驚いた科学技術のニュースは？", "世の中が変わると思った出来事は？", "好きなニュースアプリやサイトは？", "AIの進化についてどう思う？", "環境問題で関心があることは？", "宇宙開発のニュースでワクワクすることは？", "最近の流行やトレンドで注目しているものは？", "キャッシュレス決済、使ってる？", "働き方改革、どう思う？", "eスポーツの盛り上がりをどう感じる？", "自動運転、いつ頃実現すると思う？", "フェイクニュースを見分ける自信ある？", "応援しているスポーツ選手やチームの最近の活躍は？", "地域活性化のニュースで面白い取り組みは？", "フードロス問題について思うこと", "新しいSNS、何か使ってる？", "メタバースって体験したことある？", "ドローンの活用法で面白いものは？"],
            "映画": ["最近観て面白かった映画は？", "人生で一番泣いた映画は？", "繰り返し観てしまう映画は？", "好きな映画監督は誰？", "好きな俳優・女優は？", "映画館で観る？家で観る？", "忘れられない映画のセリフは？", "サウンドトラックが最高な映画は？", "人に薦めたいけど、好みが分かれそうな映画は？", "今までで一番怖かったホラー映画は？", "映画のパンフレットは買う派？", "ポップコーンは何味派？", "好きな映画のジャンルは？", "ドキュメンタリー映画観る？", "映画の原作、読む？読まない？", "吹替版と字幕版、どっちで観る？", "映画の予告編で騙された経験は？", "思わず「えっ」と声が出た衝撃のラストは？", "悪役が魅力的な映画は？", "映画デートの思い出は？", "アニメ映画の最高傑作といえば？", "映画に影響されて始めたことは？", "4DXやIMAXで観たことある？", "映画の聖地巡礼したことある？", "もし映画を撮るならどんな映画？"],
            "本": ["今読んでいる本は？", "人生を変えた一冊は？", "好きな作家は誰？", "ミステリー小説好き？", "本は紙で読む？電子書籍？", "ジャケ買いしたことある？", "積読、何冊くらいある？", "人に薦めたい漫画は？", "忘れられない本の登場人物は？", "本屋大賞、チェックしてる？", "ビジネス書、読む？", "歴史小説の面白さって？", "SF小説の壮大な世界観、好き？", "読書感想文、得意だった？", "好きな雑誌やWebメディアは？", "本を読みながら何か食べたり飲んだりする？", "図書館はよく利用する？", "自伝やノンフィクションは読む？", "詩集や歌集を読んだことある？", "寝る前に読書する習慣ある？", "速読ってできる？", "本に付箋やマーカー引くタイプ？", "読書会に参加したことある？", "もし自分で本を書くならどんな内容？", "子供の頃に好きだった絵本は？"],
            "食べ物": ["最後の晩餐に何を食べたい？", "好きな食べ物ベスト3は？", "一番好きなラーメンの味は？", "お寿司で絶対に頼むネタは？", "得意料理を教えて！", "最近食べた一番美味しかったものは？", "コンビニスイーツのおすすめは？", "目玉焼きには何をかける？", "好きなお酒とおつまみの組み合わせは？", "忘れられない思い出の味は？", "激辛料理、どこまでいける？", "パクチーは好き？嫌い？", "朝ごはんはパン派？ごはん派？", "きのこの山とたけのこの里、どっち？", "おふくろの味といえば？", "給食で好きだったメニューは？", "BBQで必ず焼きたいものは？", "ご当地グルメ、何が好き？", "料理動画、参考にする？", "フードデリバリーよく使う？", "好きなフルーツは？", "苦手な食べ物を克服した経験は？", "外食は週に何回くらい？", "お弁当に必ず入っていてほしいおかずは？", "食わず嫌いなもの、ある？"],
            "仕事": ["仕事のやりがいを感じる瞬間は？", "今の仕事で一番大変なことは？", "どうやってストレスを発散してる？", "仕事で愛用しているグッズは？", "テレワークのメリット・デメリットは？", "尊敬する上司や同僚はいる？", "仕事での一番の失敗談は？", "社会人になって一番成長したと感じることは？", "入社した頃の自分にアドバイスするなら？", "仕事中のBGM、何聴いてる？", "ランチはどうしてる？", "理想の働き方は？", "これから身につけたいスキルは？", "副業に興味ある？", "仕事で「神！」と思った瞬間は？", "あなたの職場の面白いルールや文化は？", "キャリアプラン、考えてる？", "転職の経験ある？", "学生時代のアルバイト経験は？", "仕事とプライベートのバランス、どうしてる？", "朝型？夜型？", "議事録とるの得意？", "PCのショートカットキー、何よく使う？", "タイピングの速さ、自信ある？", "もし今の仕事じゃなかったら、何してたと思う？"],
            "健康": ["健康のために気をつけていることは？", "最近ハマっている健康法は？", "好きなスポーツや運動は？", "ストレス解消法ベスト3は？", "平均睡眠時間はどれくらい？", "朝活、何かしてる？", "サプリメント飲んでる？", "好きな筋トレの種目は？", "体、柔らかい？硬い？", "健康診断の結果、どうだった？", "ダイエットの成功体験・失敗体験は？", "禁煙や禁酒の経験ある？", "肩こりや腰痛、どうしてる？", "マッサージや整体によく行く？", "ファスティング（断食）に興味ある？", "腸活、何かしてる？", "メンタルヘルスで気をつけていることは？", "1日にどれくらい歩く？", "好きな健康系ドリンクは？", "人間ドック受けたことある？", "歯の定期検診、行ってる？", "温泉や銭湯は好き？", "瞑想やマインドフルネス、試したことある？", "自分の体で自慢できるところは？", "理想の体型ってある？"],
            "未来": ["10年後の自分はどうなってると思う？", "もしタイムマシンがあったら、過去と未来どっちに行く？", "AIが進化したら、どんな世界になると思う？", "未来の乗り物ってどうなってるかな？", "老後の夢は？", "死ぬまでにやりたいことリスト、ある？", "宇宙旅行、行ってみたい？", "空飛ぶ車、いつ実現すると思う？", "不老不死、なりたい？", "ドラえもんのひみつ道具、一つもらえるなら何？", "今年中に達成したい目標は？", "5Gの次にくる通信技術って何だろう？", "100年後の日本はどうなってる？", "未来の食生活はどう変わる？", "人類は他の星に移住すると思う？", "自分の子供や孫にどんな未来を残したい？", "未来を予測する能力、欲しい？", "どんなロボットがいたら便利だと思う？", "未来の学校の姿は？", "自分の仕事はAIに奪われると思う？", "「未来っぽい！」と感じるものは？", "お金の形、未来はどうなる？", "理想の未来の家は？", "テレパシーが使えるようになったら？", "どんな社会問題が解決していてほしい？"],
            "政治": ["もし自分が総理大臣になったら、まず何をする？", "新しい祝日を一つ作れるとしたら、どんな日にする？", "選挙には行く？", "最近の政治ニュースで気になったことは？", "若者の政治参加についてどう思う？", "ふるさと納税、やったことある？", "マイナンバーカード、持ってる？", "社会がもっと良くなるために必要だと思うことは？", "リーダーに一番必要な資質って何だと思う？", "税金の使い道で「もっとこうしてほしい」と思うことは？", "住んでいる自治体の好きなところは？", "ジェンダー平等について思うこと", "食品ロス削減のために、どんな政策があったらいい？", "日本の伝統文化を守るために何が必要だと思う？", "再生可能エネルギーについてどう思う？", "外交で一番大事なことは何だと思う？", "少子高齢化問題、どんな対策が考えられる？", "教育制度について改善してほしい点は？", "ベーシックインカム制度、どう思う？", "あなたが思う「良い国」とは？"]
        };

        // HTML要素の取得
        const categorySelect = document.getElementById('category-select');
        const themeDisplay = document.getElementById('theme-display');
        const gachaButton = document.getElementById('gacha-button');
        const geminiArea = document.getElementById('gemini-feature-area');
        const digDeeperButton = document.getElementById('dig-deeper-button');
        const digDeeperResults = document.getElementById('dig-deeper-results');

        let currentTheme = ""; // 現在のテーマを保持する変数

        function setupCategories() {
            const allOption = document.createElement('option');
            allOption.value = 'all';
            allOption.textContent = 'すべてのテーマ';
            categorySelect.appendChild(allOption);
            for (const category in themeData) {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            }
        }
        
        // ガチャを回したときにAI関連の表示をリセットする
        function resetGeminiFeatures() {
            geminiArea.classList.add('hidden');
            digDeeperResults.classList.add('hidden');
            digDeeperResults.innerHTML = '';
            digDeeperButton.disabled = false;
        }

        function spinGacha() {
            gachaButton.disabled = true;
            gachaButton.textContent = '抽選中...';
            gachaButton.classList.add('opacity-70', 'cursor-not-allowed');
            themeDisplay.innerHTML = '';
            resetGeminiFeatures();

            const selectedCategory = categorySelect.value;
            let themePool = (selectedCategory === 'all') 
                ? Object.values(themeData).flat() 
                : themeData[selectedCategory];

            let shuffleCount = 0;
            const shuffleInterval = setInterval(() => {
                const randomIndex = Math.floor(Math.random() * themePool.length);
                const tempTheme = themePool[randomIndex];
                themeDisplay.innerHTML = `<p class="text-2xl font-bold text-gray-700 animate-pulse">${tempTheme}</p>`;
                shuffleCount++;

                if (shuffleCount >= 10) {
                    clearInterval(shuffleInterval);
                    const finalThemeIndex = Math.floor(Math.random() * themePool.length);
                    currentTheme = themePool[finalThemeIndex]; // 現在のテーマを更新
                    const categoryName = selectedCategory === 'all' 
                        ? Object.keys(themeData).find(key => themeData[key].includes(currentTheme)) 
                        : selectedCategory;
                    
                    themeDisplay.innerHTML = `
                        <div class="text-center">
                            <span class="inline-block bg-indigo-100 text-indigo-800 text-sm font-semibold px-3 py-1 rounded-full mb-3">${categoryName}</span>
                            <p class="text-2xl md:text-3xl font-bold text-indigo-600">${currentTheme}</p>
                        </div>
                    `;
                    
                    geminiArea.classList.remove('hidden'); // AI機能ボタンを表示
                    gachaButton.disabled = false;
                    gachaButton.textContent = 'もう一度回す';
                    gachaButton.classList.remove('opacity-70', 'cursor-not-allowed');
                }
            }, 100);
        }

        // Gemini APIを呼び出して深掘り質問を生成する
        async function getDeeperQuestions() {
            if (!currentTheme) return;

            digDeeperButton.disabled = true;
            digDeeperResults.classList.remove('hidden');
            digDeeperResults.innerHTML = '<div class="flex items-center justify-center p-4"><div class="loader"></div><p class="ml-4 text-gray-600">AIが質問を考えています...</p></div>';

            const prompt = `「${currentTheme}」という雑談テーマについて、会話がもっと面白く広がるような、ユニークで深掘りできる質問を3つ提案してください。形式は箇条書きで、質問のみを返してください。`;
            
            const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // APIキーは実行環境で自動的に設定されます
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    
                    const text = result.candidates[0].content.parts[0].text;
                    // テキストを箇条書きリストに変換
                    const questions = text.split('\n').filter(q => q.trim().length > 0).map(q => q.replace(/^[・*-]\s*/, ''));
                    
                    let html = '<ul class="list-disc list-inside space-y-2 text-gray-700">';
                    questions.forEach(question => {
                        html += `<li>${question}</li>`;
                    });
                    html += '</ul>';
                    digDeeperResults.innerHTML = html;

                } else {
                    throw new Error("AIからの有効な回答がありませんでした。");
                }
            } catch (error) {
                console.error("Gemini API call failed:", error);
                digDeeperResults.innerHTML = '<p class="text-red-600">エラーが発生しました。少し時間をおいてから、もう一度お試しください。</p>';
            } finally {
                digDeeperButton.disabled = false;
            }
        }

        // イベントリスナーの設定
        gachaButton.addEventListener('click', spinGacha);
        digDeeperButton.addEventListener('click', getDeeperQuestions);
        categorySelect.addEventListener('change', resetGeminiFeatures);


        // 初期化処理
        document.addEventListener('DOMContentLoaded', () => {
            setupCategories();
        });
    </script>
</body>
</html>
